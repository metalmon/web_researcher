# prompts_and_schemas.py
"""
Все схемы и промпты для sales_web_crawler
"""

# === SCHEMAS ===
RESPONSE_SCHEMA = {
    "type": "json_schema",
    "json_schema": {
        "name": "analysis_result",
        "schema": {
            "type": "object",
            "properties": {
                "objective": {"type": "string", "description": "Цель извлечения данных"},
                "result": {"type": "string", "description": "Результат анализа (по смыслу цели)"}
            },
            "required": ["objective", "result"]
        }
    }
}

REFLECTION_SCHEMA = {
    "type": "json_schema",
    "json_schema": {
        "name": "reflection_result",
        "schema": {
            "type": "object",
            "properties": {
                "analysis": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "objective": {"type": "string", "description": "Цель анализа"},
                            "result": {"type": "string", "description": "Результат по этой цели"}
                        },
                        "required": ["objective", "result"]
                    },
                    "description": "Массив целей и результатов анализа"
                },
                "summary": {"type": "string", "description": "Краткая сводка по всем целям"},
                "profile": {"type": "string", "description": "Психологический портрет"},
                "values": {"type": "array", "items": {"type": "string"}, "description": "Ценности"},
                "pains": {"type": "array", "items": {"type": "string"}, "description": "Боли"},
                "fears": {"type": "array", "items": {"type": "string"}, "description": "Страхи"},
                "conflicts": {"type": "array", "items": {"type": "string"}, "description": "Внутренние конфликты"},
                "motivation": {"type": "string", "description": "Мотивация"},
                "needs": {"type": "array", "items": {"type": "string"}, "description": "Потребности"},
                "hidden_needs": {"type": "array", "items": {"type": "string"}, "description": "Скрытые потребности"},
                "features": {"type": "array", "items": {"type": "string"}, "description": "Особенности"},
                "strengths": {"type": "array", "items": {"type": "string"}, "description": "Сильные стороны"},
                "weaknesses": {"type": "array", "items": {"type": "string"}, "description": "Слабые стороны"},
                "opportunities": {"type": "array", "items": {"type": "string"}, "description": "Возможности"},
                "threats": {"type": "array", "items": {"type": "string"}, "description": "Угрозы"}
            },
            "required": ["analysis"]
        }
    }
}

FINAL_SALES_SCHEMA = {
    "type": "json_schema",
    "json_schema": {
        "name": "final_sales_result",
        "schema": {
            "type": "object",
            "properties": {
                "company_profile": {"type": "string", "description": "Краткое описание деятельности компании"},
                "core_values": {"type": "array", "items": {"type": "string"}, "description": "Ключевые ценности компании"},
                "internal_pains": {"type": "array", "items": {"type": "string"}, "description": "Внутренние боли компании"},
                "hidden_concerns": {"type": "array", "items": {"type": "string"}, "description": "Скрытые опасения компании"},
                "org_culture_traits": {"type": "array", "items": {"type": "string"}, "description": "Особенности корпоративной культуры"},
                "key_success_factor": {"type": "string", "description": "Главный фактор успеха компании"},
                "key_needs": {"type": "array", "items": {"type": "string"}, "description": "Главные потребности компании, в первую очередь транзакционные"},
                "what_to_offer": {"type": "array", "items": {"type": "string"}, "description": "Продукты или услуги, которые могут быть интересны компании (особенно транзакционные)"},
                "important_considerations": {"type": "array", "items": {"type": "string"}, "description": "Важные аспекты для учёта при продаже"},
                "sales_recommendations": {"type": "array", "items": {"type": "string"}, "description": "Рекомендации по продажам"},
                "mbti_profile": {"type": "string", "description": "MBTI-профиль ЛПР (с расшифровкой: особенности мышления, какой продукт подходит, как с ними работать)"},
                "overall_assessment": {"type": "string", "description": "Общий вывод по компании"}
            },
            "required": [
                "company_profile", "core_values", "internal_pains", "hidden_concerns", "org_culture_traits", "key_success_factor", "key_needs", "what_to_offer", "important_considerations", "sales_recommendations", "mbti_profile", "overall_assessment"
            ]
        }
    }
}

MBTI_PROFILE_SCHEMA = {
    "type": "json_schema",
    "json_schema": {
        "name": "mbti_profile_result",
        "schema": {
            "type": "object",
            "properties": {
                "mbti_profile": {"type": "string", "description": "MBTI-профиль ЛПР с подробной расшифровкой"}
            },
            "required": ["mbti_profile"]
        }
    }
}

ANALYSIS_PAGE_SELECTION_SCHEMA = {
    "type": "json_schema",
    "json_schema": {
        "name": "analysis_page_selection_result",
        "schema": {
            "type": "object",
            "properties": {
                "urls": {
                    "type": "array",
                    "items": {"type": "string"},
                    "description": "Список наиболее релевантных для анализа страниц (URL)"
                }
            },
            "required": ["urls"]
        }
    }
}

# === PROMPTS ===
SINGLE_PROMPT = (
    "Ты — эксперт по психологии организаций и глубинному анализу корпоративной культуры. "
    "На основе предоставленного текста выполни поэтапный анализ внутренних ценностей и болей самой компании (НЕ КЛИЕНТОВ):\n"
    "1. Перечисли явные внутренние ценности и боли компании, которые можно выявить по тексту.\n"
    "2. Проанализируй подтекст: есть ли скрытые страхи, противоречия, недосказанности?\n"
    "3. Составь психологический портрет компании на основе этой страницы.\n"
    "4. Кратко резюмируй: что самое важное о внутренних ценностях и болях компании можно вынести из этой страницы?\n"
    "Используй глубокую рефлексию, анализируй не только явные утверждения, но и подтекст, противоречия, недосказанности. "
    "Применяй идеи Канемана: ценность — это то, чего нет, а боль — то, что мешает развитию. "
    "Если информации недостаточно, так и напиши. "
    "Ответ верни строго в виде завершённого JSON-объекта. "
    "Ответ должен быть строго на русском языке. Если ты начал отвечать на английском — перепиши ответ полностью на русском. "
    "Ответ — только на русском языке, без англоязычных вставок, максимально лаконично и по делу."
)

MULTI_PROMPTS = [
    # 1 этап
    "Ты — эксперт по психологии организаций. На основе предоставленного текста выяви явные внутренние ценности и боли самой компании (НЕ КЛИЕНТОВ). Если информации недостаточно, так и напиши. Ответ верни строго в виде завершённого JSON-объекта. Ответ должен быть строго на русском языке.",
    # 2 этап
    "Ты — эксперт по психологии организаций. Проанализируй предоставленный текст и результаты предыдущего этапа: есть ли скрытые страхи, противоречия, недосказанности (НЕ КЛИЕНТОВ)? Ответ верни строго в виде завершённого JSON-объекта. Ответ должен быть строго на русском языке.",
    # 3 этап
    "Ты — эксперт по психологии организаций. Используя текст страницы и выводы предыдущих этапов, составь психологический портрет компании (НЕ КЛИЕНТОВ). Ответ верни строго в виде завершённого JSON-объекта. Ответ должен быть строго на русском языке.",
    # 4 этап
    "Ты — эксперт по психологии организаций. Используя текст страницы и выводы предыдущих этапов, кратко резюмируй: что самое важное о внутренних ценностях и болях компании можно вынести из этой страницы? Ответ верни строго в виде завершённого JSON-объекта. Ответ должен быть строго на русском языке."
]

REFLEXION_PROMPT = (
    "Ты — эксперт по психологии организаций и глубинному анализу корпоративной культуры. "
    "Перед тобой — предварительный анализ внутренних ценностей и болей компании, выявленных на разных страницах сайта. "
    "Возможно здесь есть ценности и боли клиентов анализируемой компании. Отдели их и НЕ ИСПОЛЬЗУЙ, проводи анализ ТОЛЬКО самой компании. "
    "Твоя задача — обобщить и интегрировать эти выводы, выявить общие и противоречивые моменты, найти скрытые смыслы, страхи, внутренние ограничения, которые проявляются в совокупности всех страниц. "
    "Применяй идеи Канемана, к примеру: ценность — это то, чего нет, а боль — то, что мешает развитию. "
    "Если выводы противоречат друг другу — укажи на это. Если информации недостаточно, так и напиши. "
    "Ответь строго в формате JSON по схеме: "
    "{\n"
    "  \"analysis\": [\n"
    "    {\"objective\": \"...\", \"result\": \"...\"},\n"
    "    {\"objective\": \"...\", \"result\": \"...\"}\n"
    "  ],\n"
    "  \"summary\": \"...\",\n"
    "  \"profile\": \"...\",\n"
    "  \"values\": [\"...\"],\n"
    "  \"pains\": [\"...\"],\n"
    "  \"fears\": [\"...\"],\n"
    "  \"conflicts\": [\"...\"],\n"
    "  \"motivation\": \"...\",\n"
    "  \"needs\": [\"...\"],\n"
    "  \"hidden_needs\": [\"...\"],\n"
    "  \"features\": [\"...\"],\n"
    "  \"strengths\": [\"...\"],\n"
    "  \"weaknesses\": [\"...\"],\n"
    "  \"opportunities\": [\"...\"],\n"
    "  \"threats\": [\"...\"]\n"
    "}\n"
    "Не добавляй других ключей, не меняй структуру, не добавляй текст вне JSON. "
    "Ответ — только на русском языке, без англоязычных вставок, максимально лаконично и по делу. "
    "Фокусируйся на информации, которая поможет в продаже данному потенциальному клиенту."
)

FINAL_SALES_PROMPT = (
    "Ты — эксперт по корпоративным продажам. Твоя задача — дать рекомендации, как нам (внешней компании, внешнему продавцу) продать этой организации свои продукты или услуги. "
    "Учитывай их внутренние ценности, боли, корпоративную культуру, MBTI ЛПР и другие инсайты. "
    "Давай только те рекомендации, которые действительно уникальны и релевантны для развития, оптимизации или роста этой компании, исходя из её болей, культуры, MBTI и т.д. "
    "Избегай того, что компания уже делает сама по своему основному бизнесу. "
    "Приводи только те продукты, услуги или подходы, которые могут дать компании новое конкурентное преимущество, дополнительную ценность или закрыть её уникальные внутренние боли. "
    "Если есть внутренние возражения или опасения — укажи, как их обойти. "
    "В отдельном сообщении тебе будет передан MBTI-профиль ЛПР. Учитывай его при формировании рекомендаций и обязательно выведи его в ответе в соответствующем поле.\n"
    "\n"
    "Пример неправильного ответа: советовать компании купить или внедрить то, что она уже производит/продаёт.\n"
    "Пример правильного ответа: предложить обучение, консалтинг, инструменты для выхода на новые рынки, автоматизацию смежных процессов и т.д., если это не её основной бизнес.\n"
    "\n"
    "Ответь строго в формате JSON с ключами только на английском языке (company_profile, core_values, internal_pains, hidden_concerns, org_culture_traits, key_success_factor, key_needs, what_to_offer, important_considerations, sales_recommendations, overall_assessment, mbti_profile). Не добавляй других ключей, не меняй имена ключей, не меняй структуру. Все значения (ответы) должны быть на русском языке.\n"
    "Пример ответа:\n"
    "{\n"
    "  \"company_profile\": \"...\",\n"
    "  \"core_values\": [\"...\", \"...\"],\n"
    "  \"internal_pains\": [\"...\", \"...\"],\n"
    "  \"hidden_concerns\": [\"...\", \"...\"],\n"
    "  \"org_culture_traits\": [\"...\", \"...\"],\n"
    "  \"key_success_factor\": \"...\",\n"
    "  \"key_needs\": [\"...\", \"...\"],\n"
    "  \"what_to_offer\": [\"...\", \"...\"],\n"
    "  \"important_considerations\": [\"...\", \"...\"],\n"
    "  \"sales_recommendations\": [\"...\", \"...\"],\n"
    "  \"overall_assessment\": \"...\",\n"
    "  \"mbti_profile\": \"INTJ — стратег. Особенности мышления: ... Какой продукт подходит: ... Как с ними работать: ...\"\n"
    "}\n"
    "\n"
    "Ответ должен быть развернутым, информативным, креативным, но опираться на факты из анализа. Фокусируйся на информации, которая поможет нам в продаже данному потенциальному клиенту."
)

MBTI_PROFILE_PROMPT = (
    "Ты — эксперт по психотипированию руководителей и MBTI. "
    "Твоя задача — по предоставленной информации определить наиболее вероятный MBTI-профиль ЛПР (или нескольких, если это оправдано). "
    "1. Укажи конкретный тип (например, ENTJ, INTP и т.д.) и кратко обоснуй, почему именно этот тип. "
    "2. Опиши особенности мышления и принятия решений для этого типа в контексте корпоративных продаж. "
    "3. Дай рекомендации: как лучше коммуницировать и продавать этому типу, какие аргументы и подходы использовать. "
    "4. Если информации недостаточно для уверенного вывода — так и напиши, но предположи наиболее вероятный тип на основе имеющихся данных. "
    "Ответ верни строго в виде JSON с ключом \"mbti_profile\"."
)

ANALYSIS_PAGE_SELECTION_PROMPT = (
    "Вот список страниц сайта. "
    "Выбери из них только те, которые наиболее полезны для анализа внутренней культуры, ценностей, структуры, команды, миссии, руководства компании. "
    "Не включай страницы с продуктами, услугами, блогами, политиками, пользовательскими соглашениями и нерелевантными материалами. "
    "Максимум {limit} ссылок. Если подходящих страниц меньше — верни только их. Если нет ни одной релевантной — верни пустой список.\n\n"
    "Ответ верни строго в виде JSON-объекта по схеме: urls — массив строк (URL).\n\n"
    "Список ссылок:\n{{links}}"
) 